#!/bin/bash

# Copyright (c) 2025.
# Created by Andy Pangaribuan. All Rights Reserved.
# This product is protected by copyright and distributed under
# licenses restricting copying, distribution and decompilation.

# invisible character: https://www.compart.com/en/unicode/U+2800

. ~/.base-taskfile


#: start virtual environment
function start {
  if [ ! -d ".venv" ]; then
    python -m venv .venv
  fi

  if [[ "$(which python)" != "$(pwd)/.venv/bin/python" ]]; then
    source .venv/bin/activate
  fi

  pip install -q --upgrade pip

  if [ -f "requirements.txt" ]; then
    pip install -q -r ./requirements.txt
  fi

  echo "then set the .venv on your vscode"
  echo "cmd + shift + p"
  echo ">Python: Select Interpreter"
  echo "then select the ./.venv/bin/python"
}


#: stop virtual environment
function stop {
  if [[ "$(which python)" == "$(pwd)/.venv/bin/python" ]]; then
    deactivate
  fi
}


#: run cspell to check the project words
function spell {
  spell-py
}


#: generate the distribution
function build {
  rm -rf dist pmod.egg-info
  # pip install -q build
  python -m build
}

#: lint check
function check {
  ruff check pmod
}

#: prereq
function prereq {
  pip install virtualenv
}

#: create venv
function venv {
  python -m venv .venv
}

#: activate venv
function active {
  echo "source .venv/bin/activate" | pbcopy
  echo "paste then enter"
}

#: deactive venv
function deactive {
  deactivate
}

#: show venv active path
function path {
  python -c 'import sys; print(sys.prefix)'
}

#: show dependencies
function list {
  pip list
}

#: install dependencies
function install {
  pip install -r ./requirements.txt
  
  # printf "%s %s\n" "ipykernel :" "$(pip show ipykernel | grep Version | sed 's/Version: //g')"
  # pip install 'ipykernel==6.29.5' --force-reinstall
}



#: space
___ "$@"
